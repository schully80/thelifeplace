---
/**
 * HeaderMobile.astro — Mobile-only header & right-side drawer
 * - Drawer slides in from the right
 * - Overlay is solid white (page completely hidden)
 * - Drawer is above overlay
 * - Page scroll locked while menu is open
 */

const {
  title = "The Life Place",
  logoSrc = "/logo.png",
  class: className, // allows class forwarding from parent
} = Astro.props;

// Current path for active link styles
const path = Astro.url.pathname;
const isActive = (href: string) =>
  href === "/" ? path === "/" : path === href || (href !== "/" && path.startsWith(href));
---

<header class:list={["relative z-50 border-b bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70", className]}>
  <!-- Top bar -->
  <div class="h-16 flex items-center justify-between border-b px-4">
    <a href="/" class="flex items-center gap-3 min-w-0" aria-label={`${title} — Home`}>
      <img src={logoSrc} alt={`${title} Logo`} class="h-12 w-auto" />
      <div class="flex flex-col min-w-0">
        <span class="font-bold text-brand-red text-lg leading-tight truncate">{title}</span>
        <span class="text-[11px] text-brand-warmgray-600 text-center tracking-wide">Come. See. Jesus</span>
      </div>
    </a>

    <button
      id="mobileMenuButton"
      aria-label="Open menu"
      aria-controls="mobileNavDrawer"
      aria-expanded="false"
      class="inline-flex items-center justify-center h-10 w-10 rounded-md border border-brand-red bg-white active:scale-[0.98]"
      focus:outline-none focus:ring-2 focus:ring-brand-red focus:ring-offset-2"
    >
      <svg viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <!-- Overlay (solid white, covers page) -->
  <div
    id="mobileNavOverlay"
    class="fixed inset-0 bg-white opacity-0 pointer-events-none transition-opacity z-[9998]"
    data-overlay
  ></div>

  <!-- Drawer (RIGHT side, above overlay) -->
  <aside
    id="mobileNavDrawer"
    class="fixed inset-y-0 right-0 w-[86%] max-w-sm bg-white shadow-xl translate-x-full transition-transform will-change-transform z-[9999] focus:outline-none"
    role="dialog"
    aria-modal="true"
    aria-label="Mobile Navigation"
    tabindex="-1"
    data-drawer
  >
    <!-- Drawer header --><div class="h-16 px-4 flex items-center justify-end border-b">
  <button
    id="mobileMenuClose"
    aria-label="Close menu"
    class="h-10 w-10 inline-flex items-center justify-center rounded-md border border-brand-red bg-white
           active:scale-[0.98] 
           focus:outline-none focus:ring-2 focus:ring-brand-red focus:ring-offset-2"
  >
    <svg viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true">
      <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
    </svg>
  </button>
</div>


    <!-- Drawer body -->
    <nav class="px-2 py-2 overflow-y-auto max-h-[calc(100dvh-4rem)]" aria-label="Mobile">
      <!-- Direct link -->
      <a
        href="/what-to-expect/"
        class={`block px-3 py-3 rounded-lg text-base ${
          isActive("/what-to-expect/")
            ? "text-brand-red font-semibold bg-red-50"
            : "text-brand-darkgray hover:bg-gray-50"
        }`}
      >What to Expect</a>

      <!-- About Us (accordion) -->
      <section class="mt-1" data-accordion>
        <button
          class="w-full flex items-center justify-between px-3 py-3 rounded-lg text-left text-base text-brand-darkgray hover:bg-gray-50"
          data-accordion-trigger
          aria-expanded="false"
          aria-controls="acc-about"
        >
          <span>About Us</span>
          <svg class="h-5 w-5 transition-transform" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
        </button>
        <div
          id="acc-about"
          class="grid grid-rows-[0fr] transition-[grid-template-rows] duration-300"
          data-accordion-panel
        >
          <div class="overflow-hidden">
            <ul class="py-1">
              <li>
                <a href="/about-us/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/about-us/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Our Mission</a>
              </li>
              <li>
                <a href="/about-us/our-values" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/about-us/our-values") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Our Values</a>
              </li>
              <li>
                <a href="/about-us/leadership" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/about-us/leadership") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Meet Schulter and Jenny</a>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Generosity -->
      <a
        href="/give/"
        class={`mt-1 block px-3 py-3 rounded-lg text-base ${
          isActive("/give/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
        }`}
      >Generosity</a>

      <!-- Ministries (accordion) -->
      <section class="mt-1" data-accordion>
        <button
          class="w-full flex items-center justify-between px-3 py-3 rounded-lg text-left text-base text-brand-darkgray hover:bg-gray-50"
          data-accordion-trigger
          aria-expanded="false"
          aria-controls="acc-ministries"
        >
          <span>Ministries</span>
          <svg class="h-5 w-5 transition-transform" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
        </button>
        <div
          id="acc-ministries"
          class="grid grid-rows-[0fr] transition-[grid-template-rows] duration-300"
          data-accordion-panel
        >
          <div class="overflow-hidden">
            <ul class="py-1">
              <li>
                <a href="/ministries/new-members/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/new-members/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>New @The Life Place</a>
              </li>
              <li class="px-5 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Family</li>
              <li>
                <a href="/ministries/bring-them-to-jesus/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/bring-them-to-jesus/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Bring Them To Jesus</a>
              </li>
              <li>
                <a href="/ministries/kids/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/kids/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Kids @The Life Place</a>
              </li>
              <li>
                <a href="/ministries/gen/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/gen/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>ThisGen</a>
              </li>
              <li>
                <a href="/ministries/premarital-counseling/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/premarital-counseling/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Premarital Counseling</a>
              </li>
              <li class="px-5 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Formation</li>
              <li>
                <a href="/ministries/institute/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/institute/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>The Life Place Institute</a>
              </li>
              <li>
                <a href="/ministries/faith-and-work/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/faith-and-work/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Faith &amp; Work</a>
              </li>
              <li class="px-5 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Outreach</li>
              <li>
                <a href="/ministries/relief-center/" class={`block px-5 py-2 text-[15px] rounded-md ${
                  isActive("/ministries/relief-center/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
                }`}>Relief Center</a>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Visit -->
      <a
        href="/visit/"
        class={`mt-1 block px-3 py-3 rounded-lg text-base ${
          isActive("/visit/") ? "text-brand-red font-semibold bg-red-50" : "text-brand-darkgray hover:bg-gray-50"
        }`}
      >Visit</a>
    </nav>
  </aside>

  

  <!-- Inline behaviour -->
  <script is:inline>
    (function () {
      const body = document.documentElement; 
      const btnOpen = document.getElementById('mobileMenuButton');
      const btnClose = document.getElementById('mobileMenuClose');
      const drawer = document.getElementById('mobileNavDrawer');
      const overlay = document.getElementById('mobileNavOverlay');

      if (!btnOpen || !btnClose || !drawer || !overlay) return;
    if (overlay.parentElement !== document.body) document.body.appendChild(overlay);
    if (drawer.parentElement  !== document.body) document.body.appendChild(drawer);
      
      const open = () => {
        drawer.classList.remove('translate-x-full');   // slide IN from right
        overlay.classList.remove('pointer-events-none');
        overlay.classList.add('opacity-100');
        btnOpen.setAttribute('aria-expanded', 'true');
        body.style.overflow = 'hidden'; // lock scroll
        drawer.focus();
      };

      const close = () => {
        drawer.classList.add('translate-x-full');      // slide OUT to right
        overlay.classList.add('pointer-events-none');
        overlay.classList.remove('opacity-100');
        btnOpen.setAttribute('aria-expanded', 'false');
        body.style.overflow = ''; // unlock scroll
        btnOpen.focus();
      };

      btnOpen.addEventListener('click', open);
      btnClose.addEventListener('click', close);
      overlay.addEventListener('click', close);

      // ESC to close
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') close();
      });

      // Accordions
      document.querySelectorAll('[data-accordion]').forEach((acc) => {
        const trigger = acc.querySelector('[data-accordion-trigger]');
        const panel = acc.querySelector('[data-accordion-panel]');
        if (!trigger || !panel) return;

        trigger.addEventListener('click', () => {
          const expanded = trigger.getAttribute('aria-expanded') === 'true';
          trigger.setAttribute('aria-expanded', String(!expanded));
          const icon = trigger.querySelector('svg');
          if (icon) icon.style.transform = expanded ? '' : 'rotate(180deg)';
          panel.style.gridTemplateRows = expanded ? '0fr' : '1fr';
        });
      });
    })();
  </script>
</header>
