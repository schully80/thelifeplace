---
const {
  title = "Register",
  description = "Fill in your details below to save your spot.",
  eventCode = "GEN2025"
} = Astro.props;
---

<section class="max-w-2xl mx-auto px-4 py-12 animate-fade-in-up">
  <div class="bg-white p-6 rounded-xl shadow ring-1 ring-blue-200 space-y-6">
    <h2 class="text-2xl font-bold text-brand-red">{title}</h2>
    <p class="text-gray-700">{description}</p>

    <!-- Registration Form -->
    <form id="registrationForm"
          method="POST"
          action="https://formspree.io/f/xldwoekj"
          class="space-y-6">

      <!-- ðŸ‘¤ Personal Info -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="firstName" class="text-sm font-medium text-gray-700">First Name *</label>
          <input type="text" id="firstName" name="firstName" class="form-field" required />
        </div>

        <div class="space-y-2">
          <label for="lastName" class="text-sm font-medium text-gray-700">Last Name *</label>
          <input type="text" id="lastName" name="lastName" class="form-field" required />
        </div>
      </div>

      <!-- ðŸ“ž Contact Info -->
      <div class="space-y-2">
        <label for="contact" class="text-sm font-medium text-gray-700">Contact Number *</label>
        <input type="tel" id="contact" name="contact" class="form-field" required />
      </div>

      <div class="space-y-2">
        <label for="email" class="text-sm font-medium text-gray-700">Email Address *</label>
        <input type="email" id="email" name="email" class="form-field" required />
      </div>

      <!-- ðŸ‘¥ Attendance -->
      <div class="space-y-2">
        <label for="attendees" class="text-sm font-medium text-gray-700">Number of Persons Attending *</label>
        <input type="number" id="attendees" name="attendees" class="form-field" min="1" required />
      </div>

      <!-- ðŸ“¨ Hidden Fields -->
      <input type="hidden" name="_subject" value={`New ${eventCode} Registration`} />
      <input type="hidden" name="message" value={`Thank you for registering for ${eventCode}. We'll be in touch soon!`} />

      <!-- ðŸš€ Submit Button -->
      <button type="submit" class="btn-brand">
        <span>Save My Spot</span>
        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-5 w-5 animate-pulse"
             fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 17L17 7M7 7h10v10" />
        </svg>
      </button>
    </form>

    <!-- Inline Thank You Message -->
    <div id="thankYouMessage" class="hidden mt-10 text-center">
      <h2 class="text-2xl font-semibold text-brand-red mb-2">Thank You!</h2>
      <p class="text-lg text-brand-warmgray-700">
        Your registration has been received. Weâ€™ll be in touch soon.
      </p>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("registrationForm");
    const thankYou = document.getElementById("thankYouMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);

      try {
        const res = await fetch(form.action, {
          method: "POST",
          body: formData,
          headers: { Accept: "application/json" },
        });

        if (res.ok) {
          form.style.display = "none"; // Hide form
          thankYou.classList.remove("hidden"); // Show thank-you
        } else {
          alert("Oops! Something went wrong. Please try again.");
        }
      } catch {
        alert("Network error. Please check your connection and try again.");
      }
    });
  });
</script>
