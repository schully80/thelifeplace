---
const {
  title = "Register",
  eventName = "Bring Them To Jesus",
  paymentLink = "/give",
  successMessage = "Thank you for registering!",
  ctaText = "Save My Spot",
  fields = [
    { id: "fullName", label: "Full Name", type: "text", required: true },
    { id: "contact", label: "Contact Number", type: "tel", required: true },
    { id: "email", label: "Email Address", type: "email", required: true },
    { id: "attendees", label: "Number of People Attending", type: "number", required: true, min: 1 }
  ]
} = Astro.props;

let submitted = false;
let referenceCode = "";

function generateReferenceCode(eventName, formData) {
  const name = formData.fullName?.trim() || "Guest";
  const attendees = formData.attendees?.trim() || "1";
  return `${eventName.replace(/\s+/g, '')}-${name.replace(/\s+/g, '')}-${attendees}`;
}
---
<section class="max-w-3xl mx-auto px-4 py-12">
  <h2 class="text-3xl font-bold text-center text-brand-red mb-8">{title}</h2>

  {submitted ? (
    <div class="bg-green-50 border border-green-200 text-green-800 p-6 rounded-xl text-center space-y-2">
      <p>Thank you for registering!</p>
      <p>Your reference code: <strong>{referenceCode}</strong></p>
      <a href={paymentLink} class="inline-block mt-4 px-5 py-2.5 bg-brand-red text-white rounded-full hover:bg-red-700 transition">
        Proceed to Payment
      </a>
    </div>
  ) : }
    
    <form method="POST" class="space-y-6 bg-white p-6 rounded-xl shadow ring-1 ring-blue-200"
  on:submit={(e) => {
    e.preventDefault();
    const form = e.target;
    const formData = Object.fromEntries(new FormData(form));
    referenceCode = generateReferenceCode(eventName, formData);
    submitted = true;
  }}
>

      // Optional: send to backend here
    class="space-y-6 bg-white p-6 rounded-xl shadow ring-1 ring-blue-200">
      <div>
        <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
        <input type="text" id="fullName" name="fullName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-brand-red focus:border-brand-red" />
      </div>

      <div>
        <label for="contact" class="block text-sm font-medium text-gray-700">Contact Number</label>
        <input type="tel" id="contact" name="contact" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-brand-red focus:border-brand-red" />
      </div>

      <div>
        <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
        <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-brand-red focus:border-brand-red" />
      </div>

      <div>
        <label for="attendees" class="block text-sm font-medium text-gray-700">Number of Persons Attending</label>
        <input type="number" id="attendees" name="attendees" min="1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-brand-red focus:border-brand-red" />
      </div>

      <div class="text-center">
        <button type="submit" class="inline-flex items-center space-x-2 px-5 py-2.5 bg-brand-red text-white font-semibold rounded-full hover:bg-red-700 transition">
          <span>Save My Spot</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 17L17 7M7 7h10v10" />
          </svg>
        </button>
      </div>
    </form>
</section>