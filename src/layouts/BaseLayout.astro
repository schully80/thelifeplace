---
import "../styles/global.css";
import CookieConsent from "../components/CookieConsent.astro";
import HeaderMobile from "../components/HeaderMobile.astro";

const {
  title = "The Life Place",
  description = "Come. See. Jesus.",
} = Astro.props;

const path = Astro.url.pathname;
const isActive = (href: string) =>
  href === "/"
    ? path === "/"
    : path === href || (href !== "/" && path.startsWith(href));
---

<!DOCTYPE html>
<html lang="en" class="min-h-screen">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={description} />
    <title>{title}</title>

    <!-- Fonts & Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Source+Sans+Pro:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="bg-white antialiased min-h-screen flex flex-col">
    <!-- Mobile header (appears on < md) -->
    <HeaderMobile class="md:hidden" logoSrc="/logo.png" title="The Life Place" />

    <!-- Desktop header (hidden on mobile) -->
    <header class="hidden md:block relative z-30 border-b bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70 overflow-visible">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center gap-4">
        <!-- Logo + Title -->
        <a href="/" class="shrink-0" aria-label="The Life Place — Home">
          <img src="/logo.png" alt="The Life Place Logo" class="h-10 md:h-16 w-auto" />
        </a>

        <div class="flex flex-col min-w-0">
          <a href="/" class="site-title font-bold text-brand-red text-lg sm:text-xl md:text-2xl leading-tight">
            The Life Place
          </a>
          <span class="text-sm text-gray-600 tracking-wide">
            Come. See. Jesus
          </span>
        </div>

        <!-- 🔎 Search button (center area) -->
        <div class="flex-1 flex items-center justify-center">
          <button
            id="searchToggleDesktop"
            type="button"
            data-search-open
            class="flex items-center gap-2 px-3 py-2 rounded-full bg-gray-100 hover:bg-brand-red hover:text-white transition"
            aria-label="Open site search"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" />
            </svg>
            <span class="hidden sm:inline text-sm font-medium">Search</span>
          </button>
        </div>

        <!-- Desktop nav -->
        <nav class="flex items-center gap-6 font-montserrat text-base">
          <a
            href="/what-to-expect/"
            class={`relative px-2 py-2 after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 hover:after:w-full after:transition-all after:duration-300 ${
              isActive("/what-to-expect/")
                ? "text-brand-red after:w-full font-semibold"
                : "text-brand-darkgray hover:text-brand-red"
            }`}
          >
            What to Expect
          </a>

          <!-- About Us dropdown -->
          <div id="dd-about" data-dropdown class="relative focus-within:z-50">
            <button
              data-trigger
              type="button"
              class={`relative px-2 py-2 after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 hover:after:w-full after:transition-all after:duration-300 ${
                isActive("/about-us/")
                  ? "text-brand-red after:w-full font-semibold"
                  : "text-brand-warmgray-700 hover:text-brand-red"
              }`}
              aria-haspopup="true"
              aria-expanded="false"
            >
              About Us
            </button>

            <div
              data-menu
              class="absolute left-0 top-full -mt-px w-56 rounded-md border bg-white shadow-lg z-50 hidden max-h-80 overflow-y-auto overscroll-contain pt-1"
              role="menu"
              aria-label="About Us Menu"
            >
              <a
                href="/about-us/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Our Mission
                </span>
              </a>

              <a
                href="/about-us/our-values"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Our Values
                </span>
              </a>

              <a
                href="/about-us/leadership"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Meet Schulter and Jenny
                </span>
              </a>
            </div>
          </div>

          <!-- Generosity simple link -->
          <a
            href="/give/"
            class={`nav-underline relative z-10 px-2 py-2 whitespace-nowrap ${
              isActive("/give/") ? "text-brand-red font-semibold" : "text-brand-warmgray-700 hover:text-brand-red"
            }`}
            aria-current={isActive("/give/") ? "page" : undefined}
          >
            Generosity
          </a>

          <!-- Ministries dropdown -->
          <div id="dd-ministries" data-dropdown class="relative">
            <button
              data-trigger
              type="button"
              class={`relative px-2 py-2 whitespace-nowrap after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 hover:after:w-full after:transition-all after:duration-300 ${
                isActive("/ministries/")
                  ? "text-brand-red after:w-full font-semibold"
                  : "text-brand-warmgray hover:text-brand-red"
              }`}
              aria-haspopup="true"
              aria-expanded="false"
            >
              Ministries
            </button>

            <div
              data-menu
              class="absolute left-0 top-full -mt-px w-64 rounded-md border bg-white shadow-lg z-50 hidden max-h-96 overflow-y-auto overscroll-contain pt-1"
              role="menu"
              aria-label="Ministries Menu"
            >
              <!-- Onboarding -->
              <a
                href="/ministries/new-members/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  New @The Life Place
                </span>
              </a>

              <!-- Family -->
              <div class="px-3 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Family</div>

              <a
                href="/ministries/bring-them-to-jesus/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Bring Them To Jesus
                </span>
              </a>

              <a
                href="/ministries/kids/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Kids @The Life Place
                </span>
              </a>

              <a
                href="/ministries/gen/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  ThisGen
                </span>
              </a>

              <a
                href="/ministries/premarital-counseling/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Premarital Counseling
                </span>
              </a>

              <!-- Formation -->
              <div class="px-3 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Formation</div>

              <a
                href="/ministries/institute/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  The Life Place Institute
                </span>
              </a>

              <a
                href="/ministries/faith-and-work/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Faith &amp; Work
                </span>
              </a>

              <!-- Outreach -->
              <div class="px-3 pt-2 pb-1 text-[11px] uppercase tracking-wide text-gray-400">Outreach</div>

              <a
                href="/ministries/relief-center/"
                class="group block px-3 py-2 text-sm text-brand-darkgray hover:text-brand-red"
                role="menuitem"
              >
                <span
                  class="relative inline-block after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 after:content-[''] hover:after:w-full after:transition-all after:duration-300"
                >
                  Relief Center
                </span>
              </a>
            </div>
          </div>

          <a
            href="/visit/"
            class={`relative px-2 py-2 after:absolute after:left-0 after:-bottom-0.5 after:h-[2px] after:bg-brand-red after:w-0 hover:after:w-full after:transition-all after:duration-300 ${
              isActive("/visit/")
                ? "text-brand-red after:w-full font-semibold"
                : "text-brand-darkgray hover:text-brand-red"
            }`}
          >
            Visit
          </a>
        </nav>
      </div>
    </header>

    <!-- Page content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 flex-1">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 mt-8">
      <div class="max-w-6xl mx-auto px-4 py-10 text-center text-sm space-y-6">
        <!-- Social links -->
        <div class="flex justify-center gap-4">
          <a href="https://facebook.com/thelifeplacesa" target="_blank" rel="noopener" class="w-12 h-12 rounded-full bg-black flex items-center justify-center hover:bg-brand-red transition" aria-label="Facebook">
            <i class="fab fa-facebook-f text-2xl text-white"></i>
          </a>
          <a href="https://instagram.com/thelifeplacesa" target="_blank" rel="noopener" class="w-12 h-12 rounded-full bg-black flex items-center justify-center hover:bg-brand-red transition" aria-label="Instagram">
            <i class="fab fa-instagram text-2xl text-white"></i>
          </a>
          <a href="https://youtube.com/@thelifeplacesa" target="_blank" rel="noopener" class="w-12 h-12 rounded-full bg-black flex items-center justify-center hover:bg-brand-red transition" aria-label="YouTube">
            <i class="fab fa-youtube text-2xl text-white"></i>
          </a>
          <a href="https://open.spotify.com/show/YOUR_SPOTIFY_ID" target="_blank" rel="noopener" class="w-12 h-12 rounded-full bg-black flex items-center justify-center hover:bg-brand-red transition" aria-label="Spotify">
            <i class="fab fa-spotify text-2xl text-white"></i>
          </a>
          <a href="https://podcasts.apple.com/your-show-link" target="_blank" rel="noopener" class="w-12 h-12 rounded-full bg-black flex items-center justify-center hover:bg-brand-red transition" aria-label="Apple Podcasts">
            <i class="fas fa-podcast text-2xl text-white"></i>
          </a>
        </div>

        <!-- Cookie banner -->
        <CookieConsent />

        <!-- Footer links -->
        <div class="flex flex-wrap justify-center items-center gap-4 text-gray-600">
          <a href="/privacy-policy/" class="underline hover:underline">Privacy Policy</a>
          <a href="/cookies/" class="underline hover:underline">Cookies</a>
          <a href="/terms/" class="underline hover:underline">Terms</a>
          <span>© 2025 The Life Place. All Rights Reserved</span>
        </div>
      </div>
    </footer>

    <!-- 🔍 Search Overlay -->
    <div
      id="searchOverlay"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] hidden flex items-start justify-center pt-24 px-4"
      aria-hidden="true"
    >
      <div class="bg-white rounded-xl shadow-lg max-w-lg w-full p-6" role="dialog" aria-modal="true" aria-label="Site search">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">Search The Life Place</h2>
          <button id="searchClose" type="button" aria-label="Close search" class="text-gray-500 hover:text-brand-red">✕</button>
        </div>

        <form id="siteSearchForm" action="/search" method="GET" class="space-y-3">
          <input
            id="siteSearchInput"
            name="q"
            type="search"
            placeholder="Type to search…"
            autocomplete="off"
            class="w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:ring-brand-red focus:border-brand-red"
          />
          <div class="flex gap-2">
            <button type="submit" class="btn-primary">Search</button>
            <button type="button" id="searchClear" class="btn-ghost">Clear</button>
          </div>
        </form>

        <div id="searchResults" class="mt-6 space-y-3 hidden"></div>
      </div>
    </div>

    <!-- 🔧 Search logic (desktop + mobile buttons) -->
    <script is:inline>
      (function () {
        const html = document.documentElement;
        const overlay = document.getElementById("searchOverlay");
        const btnClose = document.getElementById("searchClose");
        const form = document.getElementById("siteSearchForm");
        const input = document.getElementById("siteSearchInput");
        const results = document.getElementById("searchResults");
        const btnClear = document.getElementById("searchClear");

        // Any element with data-search-open will open the overlay (desktop + mobile)
        const openers = document.querySelectorAll("[data-search-open]");

        if (!overlay || !btnClose || !form || !input) return;

        const open = (e) => {
          e?.preventDefault?.();
          overlay.classList.remove("hidden");
          overlay.setAttribute("aria-hidden", "false");
          html.style.overflow = "hidden";
          setTimeout(() => input.focus(), 0);
        };

        const close = (e) => {
          e?.preventDefault?.();
          overlay.classList.add("hidden");
          overlay.setAttribute("aria-hidden", "true");
          html.style.overflow = "";
        };

        openers.forEach((btn) => {
          btn.addEventListener("click", open);
          btn.addEventListener("mousedown", (evt) => evt.preventDefault());
        });

        btnClose.addEventListener("click", close);
        overlay.addEventListener("click", (e) => { if (e.target === overlay) close(e); });
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && overlay.getAttribute("aria-hidden") === "false") close(e);
          if (e.key === "/" && !e.metaKey && !e.ctrlKey && !e.altKey) {
            const tag = document.activeElement?.tagName?.toLowerCase();
            if (tag !== "input" && tag !== "textarea") {
              e.preventDefault();
              open();
            }
          }
        });

        btnClear?.addEventListener("click", () => {
          input.value = "";
          results?.classList?.add("hidden");
          if (results) results.innerHTML = "";
          input.focus();
        });

        // Inline results placeholder (stay in overlay)
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const q = input.value.trim();
          if (!q) {
            if (results) {
              results.innerHTML = '<p class="text-sm text-gray-500">Type something to search.</p>';
              results.classList.remove("hidden");
            }
            return;
          }
          if (results) {
            results.innerHTML = `
              <p class="text-sm text-gray-600">Searching for “<strong>${q.replace(/</g,'&lt;')}</strong>”…</p>
              <p class="text-sm text-gray-400">Inline search placeholder. Wire this up to your content index.</p>
            `;
            results.classList.remove("hidden");
          }
        });
      })();
    </script>
  </body>
</html>
